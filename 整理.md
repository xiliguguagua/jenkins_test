**1.音频标注方法**
使用Audacity专业音频工具，将训练音频导入工具后，播放音频的同时，根据频谱图像确定爆破音的开始帧与结束帧。通过计算帧号与帧总长之间比值，确定爆破音边界的相对时间（0~1之间浮点数，0表示音频开始时间，1表示音频结束时间）
下图为Audacity截图与频谱图截图，工具下方数字即代表指针所在帧号
![](https://huatu.98youxi.com/markdown/work/uploads/upload_efb4f6214f9afc4bbbd1282436e3b805.png)
之后将爆破音开始与结束的一对相对时间浮点数记录在excel表格中，如下图
![](https://huatu.98youxi.com/markdown/work/uploads/upload_3dba7e32acfeaf2ef1a3d971a313e83d.png)
表格第一列为音频文件序号，第二列为音频文件名，第三列为音频总长(秒)，第四列为所有爆破音边界数据对
可以通过一个简单的脚本来快速获取一个音频文件的相对时间标签

```
class i:

    def __init__(self, length):
        self.length = length
        self.file = open('./l.txt', 'w')
        self.file.flush()

    def c(self, pos):
        self.file.write(str(pos/self.length) + ',')
        self.file.flush()
```
每次为新音频文件打标签时使用
```
x = i(240768)
x.c(1200)
x.c(1210)
```
来初始化一个新文件，并写入一对开始与结束时间。写入所有时间后，读取l.txt获取全部标签浮点数，写入表格，之后重新初始化一个类，刷新l.txt

**2.爆破音检测算法说明**
将x秒数据使用librosa库load并转换成频谱特征与mfcc特征
```
# spectrum feature
spec = librosa.amplitude_to_db(abs(librosa.stft(y)))
spec = librosa.util.normalize(spec).T
features['spec'] = spec

# MFCC feature
mfcc = librosa.feature.mfcc(y=y, sr=sr, center=True, n_mfcc=self.n_feature)
mfcc = librosa.util.normalize(mfcc).T
features['mfcc'] = mfcc
```
之后初始化一个[lightgbm](https://lightgbm.readthedocs.io/)分类器，设置类别权重为均衡的，分类爆破音与非爆破音。超参根据实验结果调整而得，与默认参数之间性能区别不大。
```
model = LGBMClassifier(class_weight='balanced', max_depth=0, reg_alpha=0.1)
```
**3.检测中CPU占用率**
仅读取音频流，不检测的CPU平局占用率约为13%
![](https://huatu.98youxi.com/markdown/work/uploads/upload_a8f541fef2983995864296f7c3c9f5de.jpg)
循环读取音频流并实时检测的CPU占用率约为55%
![](https://huatu.98youxi.com/markdown/work/uploads/upload_996a7157b4126a92445746230b2c13f6.jpg)
可知检测算法CPU占用率约为40%
**4.算法测试方法**
与实机连接完成后，播放待检测音频，并开启脚本执行检测。可通过检测到爆破音后打印一些信息来实时获取检测结果，或导出检测结果与测试音频标签进行定量评估，比如计算召回率或F1指标等。也可以根据output中导出的音频样本
爆破音检测与实机播放间最多可能存在0.1*X秒的延迟，X为设置的X个data进行一次检测数量，默认为3。
检测算法对音频有一定适应性，但适应能力有限，超出适应范围后需调整检测阈值以实现检测。
可以手动调整适应时间T，越短越灵活，但适应能力会下降，越长适应能力越强，但音频音量改变后波动的时间越久。
波动时间指，从低音量转到高音量后，会存在与适应时间相同的T秒高频误检，因为此时打分整体上升；从高音量转到低音量后，会存在与适应时间相同的T秒高频漏检，因为此时打分会整体下降。
实验发现，音量越小越利于算法区分爆破音与常规音，即二者之间打分差距越大。当实际播放分贝为60左右时，阈值约为3.5~4.5。当音量超过80分贝后，检测能力会显著下降。